import express from "express";
import ical from "ical-generator";
import dayjs from "dayjs";

const app = express();
const PORT = 3000;
const TEAM = "å¹¿ä¸œå®è¿œ";

const matches = [
  { r: 1, d: "2025-12-14 19:35", h: "å¹¿ä¸œå®è¿œ", a: "å—äº¬åŒæ›¦" },
  { r: 2, d: "2025-12-16 19:35", h: "æµ™æ±Ÿç¨ å·ž", a: "å¹¿ä¸œå®è¿œ" },
  { r: 3, d: "2025-12-19 19:35", h: "å¹¿ä¸œå®è¿œ", a: "é¾™ç‹®" },
  { r: 4, d: "2025-12-21 19:35", h: "å¹¿ä¸œå®è¿œ", a: "é’å²›å›½ä¿¡æµ·å¤©" },
  { r: 5, d: "2025-12-23 19:35", h: "é¾™ç‹®", a: "å¹¿ä¸œå®è¿œ" },
  { r: 6, d: "2025-12-26 19:35", h: "å¹¿ä¸œå®è¿œ", a: "å±±ä¸œå±±é«˜" },
  { r: 7, d: "2025-12-28 19:35", h: "å±±è¥¿æ±¾é…’", a: "å¹¿ä¸œå®è¿œ" },
  { r: 8, d: "2025-12-30 19:35", h: "å¤©æ´¥è£é’¢", a: "å¹¿ä¸œå®è¿œ" },
  { r: 9, d: "2026-01-01 19:35", h: "åŒ—äº¬é¦–é’¢", a: "å¹¿ä¸œå®è¿œ" },
  { r:10, d: "2026-01-03 19:35", h: "åŒ—äº¬æŽ§è‚¡", a: "å¹¿ä¸œå®è¿œ" },
  { r:11, d: "2026-01-05 19:35", h: "å¹¿ä¸œå®è¿œ", a: "æµ™æ±Ÿç¨ å·ž" },
  { r:12, d: "2026-01-07 19:35", h: "å¹¿ä¸œå®è¿œ", a: "æ·±åœ³æ–°ä¸–çºª" },
  { r:13, d: "2026-01-11 19:35", h: "è¾½å®æ²ˆé˜³ä¸‰ç”Ÿ", a: "å¹¿ä¸œå®è¿œ" },
  { r:14, d: "2026-01-13 19:35", h: "å—äº¬åŒæ›¦", a: "å¹¿ä¸œå®è¿œ" },
  { r:15, d: "2026-01-15 19:35", h: "å¹¿ä¸œå®è¿œ", a: "ä¸Šæµ·ä¹…äº‹" },
  { r:16, d: "2026-01-17 19:35", h: "å¹¿ä¸œå®è¿œ", a: "åŒ—äº¬æŽ§è‚¡" },
  { r:17, d: "2026-01-19 19:35", h: "å››å·é”¦åŸŽ", a: "å¹¿ä¸œå®è¿œ" },
  { r:18, d: "2026-01-21 19:35", h: "å‰æž—ä¸œåŒ—è™Ž", a: "å¹¿ä¸œå®è¿œ" },
  { r:19, d: "2026-01-24 19:35", h: "å¹¿ä¸œå®è¿œ", a: "å±±è¥¿æ±¾é…’" },
  { r:20, d: "2026-01-26 19:35", h: "å¹¿ä¸œå®è¿œ", a: "å¤©æ´¥è£é’¢" },
  { r:21, d: "2026-01-28 19:35", h: "å¹¿ä¸œå®è¿œ", a: "å‰æž—ä¸œåŒ—è™Ž" },
  { r:22, d: "2026-02-01 19:35", h: "å®æ³¢å¯Œé‚¦", a: "å¹¿ä¸œå®è¿œ" },
  { r:23, d: "2026-02-03 19:35", h: "å¹¿ä¸œå®è¿œ", a: "ä¸Šæµ·ä¹…äº‹" },
  { r:24, d: "2026-03-11 20:00", h: "æ–°ç–†å¹¿æ±‡", a: "å¹¿ä¸œå®è¿œ" },
  { r:25, d: "2026-03-13 20:00", h: "æ·±åœ³æ–°ä¸–çºª", a: "å¹¿ä¸œå®è¿œ" },
  { r:26, d: "2026-03-15 19:35", h: "å¹¿ä¸œå®è¿œ", a: "è¾½å®æ²ˆé˜³ä¸‰ç”Ÿ" },
  { r:27, d: "2026-03-17 19:35", h: "å¹¿ä¸œå®è¿œ", a: "æ–°ç–†å¹¿æ±‡" },
  { r:28, d: "2026-03-20 19:35", h: "æ±Ÿè‹è‚¯å¸äºš", a: "å¹¿ä¸œå®è¿œ" },
  { r:29, d: "2026-03-23 19:35", h: "ä¸Šæµ·ä¹…äº‹", a: "å¹¿ä¸œå®è¿œ" },
  { r:30, d: "2026-03-25 19:35", h: "å¹¿ä¸œå®è¿œ", a: "å››å·é”¦åŸŽ" },
  { r:31, d: "2026-03-27 19:35", h: "å¹¿ä¸œå®è¿œ", a: "åŒ—äº¬é¦–é’¢" },
  { r:32, d: "2026-03-29 19:35", h: "å››å·é”¦åŸŽ", a: "å¹¿ä¸œå®è¿œ" },
  { r:33, d: "2026-03-31 19:35", h: "å¹¿ä¸œå®è¿œ", a: "æ±Ÿè‹è‚¯å¸äºš" },
  { r:34, d: "2026-04-04 19:35", h: "å¹¿ä¸œå®è¿œ", a: "æµ™æ±Ÿå¹¿åŽ¦" },
  { r:35, d: "2026-04-06 19:35", h: "å±±ä¸œå±±é«˜", a: "å¹¿ä¸œå®è¿œ" },
  { r:36, d: "2026-04-08 19:35", h: "é’å²›å›½ä¿¡æµ·å¤©", a: "å¹¿ä¸œå®è¿œ" },
  { r:37, d: "2026-04-10 19:35", h: "å¹¿ä¸œå®è¿œ", a: "å‰æž—ä¸œåŒ—è™Ž" },
  { r:38, d: "2026-04-12 19:35", h: "æµ™æ±Ÿå¹¿åŽ¦", a: "å¹¿ä¸œå®è¿œ" },
  { r:39, d: "2026-04-14 19:35", h: "å¹¿ä¸œå®è¿œ", a: "å®æ³¢å¯Œé‚¦" },
  { r:40, d: "2026-04-18 19:35", h: "å¹¿ä¸œå®è¿œ", a: "ç¦å»ºæµ”å…´" },
  { r:41, d: "2026-04-20 19:35", h: "å±±è¥¿æ±¾é…’", a: "å¹¿ä¸œå®è¿œ" },
  { r:42, d: "2026-04-24 19:35", h: "ç¦å»ºæµ”å…´", a: "å¹¿ä¸œå®è¿œ" },
];

app.get("/guangdong-2025-2026.ics", (req, res) => {
  const cal = ical({
    name: "å¹¿ä¸œå®è¿œ CBA 2025â€“2026",
    timezone: "Asia/Shanghai",
  });

  matches.forEach(m => {
    const isHome = m.h === TEAM;
    const emoji = isHome ? "ðŸ " : "âœˆï¸";

    const start = dayjs(m.d).toDate();
    const end = dayjs(m.d).add(2, "hour").toDate();

    cal.createEvent({
      start,
      end,
      summary: `${emoji} CBAï½œ${m.h} vs ${m.a}`,
      description: `ç¬¬${m.r}è½®ï½œ${isHome ? "ä¸»åœºæ¯”èµ›" : "å®¢åœºæ¯”èµ›"}`,
    });
  });

  res.setHeader("Content-Type", "text/calendar; charset=utf-8");
  res.send(cal.toString());
});

app.listen(PORT, () => {
  console.log(`WebCal ready: http://localhost:${PORT}/guangdong-2025-2026.ics`);
});
